# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура проекта 
Данный сайт реализован по MPV (Model-View-Presenter) паттерну и использует событийно-ориентированный подход, реализующийся с помощью класса EventEmitter:

| **Компонент** | **Описание**                  | **Первичный класс (абстрактный)** | **Дочерние классы** |
|:------------: |:----------------------------: | :-------------------------------:	|	:-----------------: |
| Model         | Уровень данных                | Model       		                  | AppState <br> Item <br> Order   |
| View          | Уровень отображения           | View        		                  | Page <br> Modal <br> ShoppingCart <br> Card <br> ShoppingCartItem <br> Form <br> ContactsForm <br> DeliveryForm <br> Success |                   
| Presenter     | Прослойка между View и Model  | Отсутствует        		            | Отсутствуют (Реализация в index.ts) |

## Базовый код

### Класс `EventEmitter`
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события. Класс имеет методы `on`, `off`, `emit`  — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно. Дополнительно реализованы методы `onAll` и `offAll` — для подписки на все события и сброса всех подписчиков. Интересным дополнением является метод `trigger`, генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter`.

### Класс `Api`
Класс, который обеспечивает доступ к веб-сервису. Он реализует основные операций: GET, POST, DELETE.

### Класс `View<T>` 
Класс для наследование модели отображения. Он реализует базовые элементы для работы с элементами (например, установка текста у элемента). 

### Класс `Model<T>`
Класс для компонентов уровня данных. Его функции: связывание переданных данных со свойством объекта (это реализовано в конструкторе) и инициализация вызова именованных событий через метод `emitChanges`.

## Компоненты уровня данных

### Класс `AppState` 
Класс для общих данных приложения, отслеживающий состояние всего приложения.
* `order` - отслеживает состояние заказа
* `preview` - отслеживает тот лот, который находится в модальном окне
* `catalog` - отслеживание списка доступных лотов, при установке данного свойства вызывается событие `catalog:changed`
* `isItemInShoppingCart()` - метод, который принимает лот и возращает булевое значение, показывающие есть ли лот в корзине
* `clearShoppingCart()` - метод, который чистит корзину
* `getTotalAmount()` - метод, который возращает итоговую (общую) сумму товаров
* `getShoppingCartIds()` - метод, возращающий массив строк, состоящий из id-шников товаров в корзине
* `initOrder()` - метод, который инициализирует заказ
```typescript
interface IAppState {
	_catalog: IItem[];
	_order: Order;
	_preview: IItem;
	isItemInShoppingCart: (item: IItem) => boolean;
	clearShoppingCart: () => void;
	getTotalAmount: () => string[];
	getShoppingCartIds: () => string[];
	initOrder: () => void;
}
```

### Класс `Item`
Класс данных для отдельной карточки. Реализует событие `lot:changed`
* `id` - id лота
* `title` - название лота
* `description` - описание лота (необязательный пункт)
* `image` - картинка лота
* `category` - категория лота
* `price` - цена лота
* `isOrdered` - заказан ли лот
* `placeInShoppingCart()` - метод, возращающий место лота в корзине
* `removeFromShoppingCart()` - метод, удаляющий лот из корзины
```typescript
interface IItem {
	id: number;
	title: string;
	description?: string;
	image: string;
	category: string;
	price: number;
	isOrdered: boolean;
	placeInShoppingCart: () => void;
	removeFromShoppingCart: () => void;
}
```

### Класс `Order`
Класс данных процесса оформления заказа. Он содержит те свойства, которые отображаются на соответствующих форм и реализует простейшую логику валидации свойств на наличие значений. Если происходят изменения в любом из доступных свойств, то вызывается проверка всех полей и генерируется событие `formErrors:changed`
```typescript
interface IOrder {
	_payment: IPaymentType;
	_adress: string;
	_email: string;
	_phone: string;
	_items: IItem[];
	_formErrors: object;
	validateOrder: () => void;
	clearOrder: () => void;
	validatePayment: () => void;
	validateAddress: () => void;
	validateEmail: () => void;
	validatePhone: () => void;
	postOrder: () => void;
}
```

## Компоненты уроня отображения

### Класс `Page` 
Класс отображения всей страницы.
* `_counter` - элемент отображения количества товаров в корзине
* `_galery` - элемент отображения всех лотов
* `_wrapper` - обертка, которая позволяет блокировать прокрутка страницы, если открыто модальное окно
* `_shoppingCart` - кнопка, которая отображет корзину. При нажатии на кнопку вызывается событие `shoppingCart:open` <br>
Также позволяет назначить(`set`) `counter`, `catalog` и `locked`.

### Класс `Modal` 
Класс отображения модального окна.
* `_closeButton` - элемент для отображения кнопки закрытия модального окна
* `_content` - элемент для отображения внутреннего контента модального окна
* `open()` - метод для открытия окна
* `close()` - метод для закрытия окна<br>
Также позволяет назначить(`set`) `content`

### Класс `ShoppingCart` 
Класс отображения корзины.
* `_list` - элемент списка отображаемых элементов в корзине
* `_total` - элемент общей стоимости корзины
* `_button` - элемент кнопки для открытия формы оформления заказа, который вызывает событие `order_payment:open`

### Класс `Card` 
Класс для отображения карточки.
* `_title` - элемент названия карточки
* `_description` - элемент описания карточки
* `_image` - элемент изображения карточки
* `_category` - элемент категории карточки
* `_price` - элемент стоимости лота
* `_button` - элемент открытия карточки <br>
Также позволяет назначить(`set`) `title`, `description`, `image`, `category`, `price`, `button`.

### Класс `ShoppingCartItem`
Класс отображение элементов корзины.
* `_index` - элемент порядкового номера элемента в корзине
* `_title` - элемент названия элемента в корзине
* `_price` - элемент стоимости элемента в корзине
* `_deleteButton` - элемент кнопки удаления элемента из корзины <br>
Также позволяет назначить(`set`) `index`, `title`, `price`.

### Класс `Form<T>` 
Класс отображения базовой формы.
* `_submit` - элемент кнопки отправки формы
* `_errors` - элемент блока отображения ошибок в форме <br>
Также позволяет назначить(`set`) `valid`, `errors`.
На данный класс на весь контейнер отображения привязывается событие отслеживание `input`, для того, чтобы можно было вызвать события `container.field:change`, `container:submit`

### Класс `DeliveryForm` 
Класс для отображения формы оформления заказа с адресом и способом оплаты, наследуется от класса `Form`.
* `_payment` - элемент способа оплаты
* `_adress` - элемент адреса доставки <br>
Также позволяет назначить(`set`) `payment`, `adress`.
```typescript
type IPaymentType = 'card' | 'cash'
interface IOrderDeliveryForm {
	payment: IPaymentType;
	address: string;
}
```

### Класс `ContactsForm` 
Класс для отображения формы оформления заказа с информацией, наследуется от класса `Form`.
* `_email` - электронная почта
* `_phone` - номер телефона <br>
Также позволяет назначить(`set`) `email`, `phone`.

```typescript
interface IOrderContactsForm {
		email: string; 
		phone: string;
}
type IOrderForm = IOrderDeliveryForm & IOrderContactsForm;
```

### Класс `Success` 
Класс для отображения информации об оформленном заказе
* `_total` - общая сумма заказа, получаемая с сервера <br>
Также позволяет назначить(`set`) `total`.

## Внешние связи

### LarekAPI
Класс взаимодействия с API-сервером.
* `getLotItem()` - метод для получения информации по определенному лоту
* `getLotList()` - метод для получения информации по всем лотам
* `postOrderLots()` - метод для оформления заказа

## Размещение в сети
Ссылка на репозиторий: https://github.com/pudgekaramelkin/web-larek-frontend
